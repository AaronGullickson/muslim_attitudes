---
output:
  pdf_document:
    fig_caption: yes
    template: ./resources/aog-latex-ms.tex
fontfamily: mathpazo
fontsize: 11pt
appendix: true
appendixletter: S
---

```{r setup, echo=FALSE, warning=FALSE, error=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, error = FALSE, warning = FALSE,
                      fig.height=3.5)
library(here)
source(here("analysis","useful_functions.R"))
source(here("analysis","check_packages.R"))
load(here("analysis","output","analytic_samples.RData"))
load(here("analysis","output","country_data.RData"))
```

# Supplementary Material

```{r gdp_models, echo=FALSE, results='asis'}
formula_baseline <- formula(violence~(1+religiosity+educqq_scl|country)+
                              religiosity+educqq_scl)
formula_demog <- update(formula_baseline, .~.+incomeqq_scl+
                          age25_29+age30_34+age35_39+age40_44+
                          age45_49+age50_54+age55_59+ageAge60orover+
                          Female+Urban+Shia+Other+Nothinginparticular+sufi_ctr)
formula_theocons <- update(formula_demog, .~.+NecessarytobelieveinGodtobemoral+
                             islam_truth_ctr+islam_oneway_ctr)
formula_attitudes <- update(formula_theocons, .~.+conflict_modern_ctr+
                              anti_western+anti_democratic_ctr+social_cons)

formula_gdp_intercept <- update(formula_attitudes, .~.+lgdpcap_scaled)
formula_gdp_full <- update(formula_attitudes, .~.+(religiosity+educqq_scl)*lgdpcap_scaled)

results_gdp_intercept <- pool_re_models(mclapply(analytic_samples, function(x) {
  lmer.converge(formula_gdp_intercept, data=x)
}))
results_gdp_full <- pool_re_models(mclapply(analytic_samples, function(x) {
  lmer.converge(formula_gdp_full, data=x)
}))

convert_model_re <- function(model) {
  tr <- createTexreg(
    coef.names = names(model$fixef$beta), 
    coef = model$fixef$beta, 
    se = model$fixef$se, 
    pvalues = model$fixef$pvalue,
    gof.names = c("N (individual)","N (country)", "BIC",
                  "SD (religiosity)","SD (education quantile)",
                  "r(intercept, religiosity)","r(intercept, education)",
                  "r(religiosity, education)"),
    gof = c(model$sumStats$n, model$sumStats$ngrp, model$sumStats$BIC,
            model$ranef_sd["religiosity"], model$ranef_sd["educqq_scl"],
            model$ranef_cor["(Intercept)","religiosity"],
            model$ranef_cor["(Intercept)","educqq_scl"],
            model$ranef_cor["religiosity","educqq_scl"]), 
    gof.decimal = c(F,F,F,T,T,T,T,T)
  )
}

knitreg(lapply(list(results_gdp_intercept, results_gdp_full),
               convert_model_re),
        digits=3,
        custom.coef.names=c("Intercept","Religiosity","Education quantile",
                            "Income quantile","Age 25-29","Age 30-34","Age 35-39",
                            "Age 40-44","Age 45-49","Age 50-54","Age 55-59",
                            "Age 60 and over", "Female", "Urban", "Shia",
                            "Other denomination","Just a Muslim", "Sufi",
                            "Necessary to believe in god to be moral",
                            "Islam is the one true faith",
                            "One way to interpret relig. teachings",
                            "Religion in conflict with modernity",
                            "Anti-Westernization scale",
                            "Prefers strong leader to democracy",
                            "Socially conservative scale",
                            "GDP per capita (logged)",
                            "log GDP x religiosity", "log GDP x education quantile"),
        single.row=TRUE,
        dcolumn=TRUE,
        caption="Comparing results from multilevel models predicting support for violent practices for violating norms among Muslims using the Human Development Index vs. logged GDP per capita.",
        caption.above=TRUE,
        custom.note="\\parbox{\\linewidth}{\\vspace{2pt} \\small %stars \\\\ \\emph{Notes:} All models include random country-level intercepts and slopes for some variables. All quantitative variables are divided by twice their standard deviation for comparability. Results are based on five complete datasets with imputation for missing values.}")
```

```{r religiosity_sensitivity_models, echo=FALSE, results='asis'}
formula_relig_sep <- formula(violence~(1+attend.scale+relig_important.scale+prayer.scale+
                                         educqq_scl|country)+
                               educqq_scl+incomeqq_scl+
                               age25_29+age30_34+age35_39+age40_44+
                               age45_49+age50_54+age55_59+ageAge60orover+
                               Female+Urban+Shia+Other+Nothinginparticular+sufi_ctr+
                               NecessarytobelieveinGodtobemoral+
                               islam_truth_ctr+islam_oneway_ctr+
                               conflict_modern_ctr+anti_western+anti_democratic_ctr+
                               social_cons+
                               attend.scale+relig_important.scale+prayer.scale)
formula_relig2 <- formula(violence~(1+religiosity2+attend.scale+educqq_scl|country)+
                            educqq_scl+incomeqq_scl+
                            age25_29+age30_34+age35_39+age40_44+
                            age45_49+age50_54+age55_59+ageAge60orover+
                            Female+Urban+Shia+Other+Nothinginparticular+sufi_ctr+
                            NecessarytobelieveinGodtobemoral+
                            islam_truth_ctr+islam_oneway_ctr+
                            conflict_modern_ctr+anti_western+anti_democratic_ctr+
                            social_cons+
                            religiosity2+attend.scale)

results_relig_sep <- pool_re_models(mclapply(analytic_samples, function(x) {
  lmer.converge(formula_relig_sep, data=x)
}))

results_relig2 <- pool_re_models(mclapply(analytic_samples, function(x) {
  lmer.converge(formula_relig2, data=x)
}))
  
convert_model_re_relig <- function(model) {
  tr <- createTexreg(
    coef.names = names(model$fixef$beta), 
    coef = model$fixef$beta, 
    se = model$fixef$se, 
    pvalues = model$fixef$pvalue,
    gof.names = c("N (individual)","N (country)", "BIC"),
    gof = c(model$sumStats$n, model$sumStats$ngrp, model$sumStats$BIC), 
    gof.decimal = c(F,F,F)
  )
}

knitreg(lapply(list(results_relig_sep, results_relig2),
               convert_model_re_relig),
        digits=3,
        custom.coef.names=c("Intercept","Education quantile",
                            "Income quantile","Age 25-29","Age 30-34","Age 35-39",
                            "Age 40-44","Age 45-49","Age 50-54","Age 55-59",
                            "Age 60 and over", "Female", "Urban", "Shia",
                            "Other denomination","Just a Muslim", "Sufi",
                            "Necessary to believe in god to be moral",
                            "Islam is the one true faith",
                            "One way to interpret relig. teachings",
                            "Religion in conflict with modernity",
                            "Anti-Westernization scale",
                            "Prefers strong leader to democracy",
                            "Socially conservative scale",
                            "Mosque attendance scale","Religion important scale",
                            "Prayer frequency scale", 
                            "Prayer and religion important scale"),
        single.row=TRUE,
        dcolumn=TRUE,
        caption="Results from multilevel models predicting support for violent practices for violating norms among Muslims using alternative religiosity measures.",
        caption.above=TRUE,
        custom.note="\\parbox{\\linewidth}{\\vspace{2pt} \\small %stars \\\\ \\emph{Notes:} All models include random country-level intercepts and slopes for some variables. All quantitative variables are divided by twice their standard deviation for comparability. Results are based on five complete datasets with imputation for missing values.}")
```

```{r education_sensitivity_models, echo=FALSE, results='asis'}
formula_baseline_educ_lvl <- formula(violence~(1+religiosity+Secondary+Post_Secondary|country)+
                              religiosity+Secondary+Post_Secondary)
formula_demog_educ_lvl <- update(formula_baseline_educ_lvl, .~.+incomeqq_scl+
                          age25_29+age30_34+age35_39+age40_44+
                          age45_49+age50_54+age55_59+ageAge60orover+
                          Female+Urban+Shia+Other+Nothinginparticular+sufi_ctr)
formula_theocons_educ_lvl <- update(formula_demog_educ_lvl, .~.+NecessarytobelieveinGodtobemoral+
                             islam_truth_ctr+islam_oneway_ctr)
formula_attitudes_educ_lvl <- update(formula_theocons_educ_lvl, .~.+conflict_modern_ctr+
                              anti_western+anti_democratic_ctr+social_cons)

results_attitudes_educ_lvl <- pool_re_models(mclapply(analytic_samples, function(x) {
  lmer.converge(formula_attitudes_educ_lvl, data=x)
}))

#the function for converting back for knitreg will need to be model specific so 
#it goes here and not useful functions
convert_model_re_educ <- function(model) {
  tr <- createTexreg(
    coef.names = names(model$fixef$beta), 
    coef = model$fixef$beta, 
    se = model$fixef$se, 
    pvalues = model$fixef$pvalue,
    gof.names = c("N (individual)","N (country)", "BIC",
                  "SD (religiosity)","SD (secondary)","SD (post-secondary)",
                  "r(intercept, religiosity)","r(intercept, secondary)",
                  "r(intercept, post-secondary)","r(religiosity, secondary)",
                  "r(religiosity, post-secondary)", "r(secondary, post-secondary)"),
    gof = c(model$sumStats$n, model$sumStats$ngrp, model$sumStats$BIC,
            model$ranef_sd["religiosity"], model$ranef_sd["Secondary"],
            model$ranef_sd["Post_Secondary"],
            model$ranef_cor["(Intercept)","religiosity"],
            model$ranef_cor["(Intercept)","Secondary"],
            model$ranef_cor["(Intercept)","Post_Secondary"],
            model$ranef_cor["religiosity","Secondary"], 
            model$ranef_cor["religiosity","Post_Secondary"],
            model$ranef_cor["Secondary","Post_Secondary"]), 
    gof.decimal = c(F,F,F,T,T,T,T,T,T,T,T,T)
  )
}

knitreg(convert_model_re_educ(results_attitudes_educ_lvl),
        digits=3,
        custom.coef.names=c("Intercept","Religiosity","Secondary","Post-Secondary",
                            "Income quantile","Age 25-29","Age 30-34","Age 35-39",
                            "Age 40-44","Age 45-49","Age 50-54","Age 55-59",
                            "Age 60 and over", "Female", "Urban", "Shia",
                            "Other denomination","Just a Muslim", "Sufi",
                            "Necessary to believe in god to be moral",
                            "Islam is the one true faith",
                            "One way to interpret relig. teachings",
                            "Religion in conflict with modernity",
                            "Anti-Westernization scale",
                            "Prefers strong leader to democracy",
                            "Socially conservative scale"),
        single.row=TRUE,
        dcolumn=TRUE,
        caption="Results from multilevel models predicting support for violent practices for violating norms among Muslims using absolute educational attainment rather than education quantile.",
        caption.above=TRUE,
        custom.note="\\parbox{\\linewidth}{\\vspace{2pt} \\small %stars \\\\ \\emph{Notes:} All models include random country-level intercepts and slopes for some variables. All quantitative variables are divided by twice their standard deviation for comparability. Results are based on five complete datasets with imputation for missing values.}")
```


